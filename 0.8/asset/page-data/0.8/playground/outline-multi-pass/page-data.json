{"componentChunkName":"component---src-templates-playground-tsx","path":"/0.8/playground/outline-multi-pass","result":{"pageContext":{"node":{"internal":{"content":"(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"dat.gui\", \"oasis-engine\", \"@oasis-engine-toolkit/controls\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"dat.gui\"), require(\"oasis-engine\"), require(\"@oasis-engine-toolkit/controls\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.dat, global.oasisEngine, global[\"@oasisEngineToolkit/controls\"]);\n    global.index = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (dat, _oasisEngine, _controls) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n\n  function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\n  function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\n  function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n  function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\n  function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\n  var gui = new dat.GUI();\n  var engine = new _oasisEngine.WebGLEngine(\"canvas\");\n  engine.run();\n  engine.canvas.resizeByClientSize();\n  var scene = engine.sceneManager.activeScene;\n  var rootEntity = scene.createRootEntity();\n  scene.background.solidColor.set(1, 1, 1, 1); // camera\n\n  var cameraNode = rootEntity.createChild(\"camera_node\");\n  cameraNode.transform.setPosition(0, 1.3, 1);\n  var camera = cameraNode.addComponent(_oasisEngine.Camera);\n  camera.enableFrustumCulling = false;\n  cameraNode.addComponent(_controls.OrbitControl).target.set(0, 1.3, 0); // ambient light\n\n  engine.resourceManager.load({\n    type: _oasisEngine.AssetType.Env,\n    url: \"https://gw.alipayobjects.com/os/bmw-prod/89c54544-1184-45a1-b0f5-c0b17e5c3e68.bin\"\n  }).then(function (ambientLight) {\n    scene.ambientLight = ambientLight;\n    ambientLight.specularIntensity = ambientLight.diffuseIntensity = 2;\n  });\n  engine.resourceManager.load({\n    type: _oasisEngine.AssetType.Prefab,\n    url: \"https://gw.alipayobjects.com/os/OasisHub/440000554/3615/%25E5%25BD%2592%25E6%25A1%25A3.gltf\"\n  }).then(function (gltf) {\n    var defaultSceneRoot = gltf.defaultSceneRoot;\n    rootEntity.addChild(defaultSceneRoot);\n    openDebug();\n  });\n  /** ------------------ Border ------------------ */\n  // 外描边-模版测试\n\n  var Border = /*#__PURE__*/function (_Script) {\n    _inheritsLoose(Border, _Script);\n\n    var _proto = Border.prototype;\n\n    _proto.getBorderMaterial = function getBorderMaterial(engine) {\n      if (!this.material) {\n        if (!_oasisEngine.Shader.find(\"border-shader\")) {\n          var vertex = \"\\n                 attribute vec3 POSITION;\\n                 attribute vec3 NORMAL;\\n   \\n                 uniform float u_width;\\n                 uniform mat4 u_MVPMat;\\n                 uniform mat4 u_modelMat;\\n                 uniform mat4 u_viewMat;\\n                 uniform mat4 u_projMat;\\n                 uniform mat4 u_normalMat;\\n                 \\n                 void main() {\\n                    vec4 mPosition = u_modelMat * vec4(POSITION, 1.0);\\n                    vec3 mNormal = normalize( mat3(u_normalMat) * NORMAL );\\n                    mPosition.xyz += mNormal * u_width;\\n                    gl_Position = u_projMat * u_viewMat * mPosition;\\n                 }\\n                 \";\n          var fragment = \"\\n                 uniform vec3 u_color;\\n \\n                 void main(){\\n                   gl_FragColor = vec4(u_color, 1);\\n                 }\\n                 \";\n\n          _oasisEngine.Shader.create(\"border-shader\", vertex, fragment);\n        }\n\n        var material = new _oasisEngine.Material(engine, _oasisEngine.Shader.find(\"border-shader\"));\n        this.material = material;\n        material.renderState.rasterState.cullMode = _oasisEngine.CullMode.Off;\n        var stencilState = material.renderState.stencilState;\n        stencilState.enabled = true;\n        stencilState.referenceValue = 1;\n        stencilState.compareFunctionFront = _oasisEngine.CompareFunction.NotEqual;\n        stencilState.compareFunctionBack = _oasisEngine.CompareFunction.NotEqual;\n        stencilState.writeMask = 0x00;\n        this.size = this._size;\n        this.color = this._color;\n      }\n\n      return this.material;\n    };\n\n    _proto.showBorder = function showBorder(renderer) {\n      var entity = renderer.entity;\n      var material = renderer.getMaterial();\n      var stencilState = material.renderState.stencilState;\n      stencilState.enabled = true;\n      stencilState.referenceValue = 1;\n      stencilState.passOperationFront = _oasisEngine.StencilOperation.Replace;\n      var borderMaterial = this.getBorderMaterial(entity.engine);\n      var borderRenderer = entity.addComponent(_oasisEngine.MeshRenderer);\n      borderRenderer.mesh = renderer.mesh;\n      borderRenderer.setMaterial(borderMaterial);\n      borderRenderer.priority = 1;\n      this.borderRenderer.push(borderRenderer);\n    };\n\n    function Border(entity) {\n      var _this;\n\n      _this = _Script.call(this, entity) || this;\n      _this.material = void 0;\n      _this.borderRenderer = [];\n      _this._size = 3;\n      _this._color = new _oasisEngine.Color(0, 0, 0, 1);\n      var meshes = [];\n      rootEntity.getComponentsIncludeChildren(_oasisEngine.MeshRenderer, meshes);\n      meshes.forEach(function (mesh) {\n        _this.showBorder(mesh);\n      });\n      return _this;\n    }\n\n    _proto.onDestroy = function onDestroy() {\n      this.borderRenderer.forEach(function (renderer) {\n        renderer.destroy();\n      });\n      this.borderRenderer.length = 0;\n    };\n\n    _createClass(Border, [{\n      key: \"size\",\n      get: function get() {\n        return this._size;\n      },\n      set: function set(value) {\n        this.material.shaderData.setFloat(\"u_width\", value * 0.001);\n        this._size = value;\n      }\n    }, {\n      key: \"color\",\n      get: function get() {\n        return this._color;\n      },\n      set: function set(value) {\n        this.material.shaderData.setColor(\"u_color\", value);\n        this._color = value;\n      }\n    }]);\n\n    return Border;\n  }(_oasisEngine.Script); // 内描边-背面剔除\n\n\n  var Border2 = /*#__PURE__*/function (_Script2) {\n    _inheritsLoose(Border2, _Script2);\n\n    var _proto2 = Border2.prototype;\n\n    _proto2.getBorderMaterial = function getBorderMaterial(engine) {\n      if (!this.material) {\n        if (!_oasisEngine.Shader.find(\"border-shader\")) {\n          var vertex = \"\\n                 attribute vec3 POSITION;\\n                 attribute vec3 NORMAL;\\n   \\n                 uniform float u_width;\\n                 uniform mat4 u_MVPMat;\\n                 uniform mat4 u_modelMat;\\n                 uniform mat4 u_viewMat;\\n                 uniform mat4 u_projMat;\\n                 uniform mat4 u_normalMat;\\n                 \\n                 void main() {\\n                    vec4 mPosition = u_modelMat * vec4(POSITION, 1.0);\\n                    vec3 mNormal = normalize( mat3(u_normalMat) * NORMAL );\\n                    mPosition.xyz += mNormal * u_width;\\n                    gl_Position = u_projMat * u_viewMat * mPosition;\\n                 }\\n                 \";\n          var fragment = \"\\n                 uniform vec3 u_color;\\n \\n                 void main(){\\n                   gl_FragColor = vec4(u_color, 1);\\n                 }\\n                 \";\n\n          _oasisEngine.Shader.create(\"border-shader\", vertex, fragment);\n        }\n\n        var material = new _oasisEngine.Material(engine, _oasisEngine.Shader.find(\"border-shader\"));\n        this.material = material;\n        material.renderState.rasterState.cullMode = _oasisEngine.CullMode.Front;\n        this.size = this._size;\n        this.color = this._color;\n      }\n\n      return this.material;\n    };\n\n    _proto2.showBorder = function showBorder(renderer) {\n      var entity = renderer.entity;\n      var borderMaterial = this.getBorderMaterial(entity.engine);\n      var borderRenderer = entity.addComponent(_oasisEngine.MeshRenderer);\n      borderRenderer.mesh = renderer.mesh;\n      borderRenderer.setMaterial(borderMaterial);\n      borderRenderer.priority = 1;\n      this.borderRenderer.push(borderRenderer);\n    };\n\n    function Border2(entity) {\n      var _this2;\n\n      _this2 = _Script2.call(this, entity) || this;\n      _this2.material = void 0;\n      _this2.borderRenderer = [];\n      _this2._size = 3;\n      _this2._color = new _oasisEngine.Color(0, 0, 0, 1);\n      var renderers = [];\n      rootEntity.getComponentsIncludeChildren(_oasisEngine.MeshRenderer, renderers);\n      renderers.forEach(function (renderer) {\n        _this2.showBorder(renderer);\n      });\n      return _this2;\n    }\n\n    _proto2.onDestroy = function onDestroy() {\n      this.borderRenderer.forEach(function (renderer) {\n        renderer.destroy();\n      });\n      this.borderRenderer.length = 0;\n    };\n\n    _createClass(Border2, [{\n      key: \"size\",\n      get: function get() {\n        return this._size;\n      },\n      set: function set(value) {\n        this.material.shaderData.setFloat(\"u_width\", value * 0.001);\n        this._size = value;\n      }\n    }, {\n      key: \"color\",\n      get: function get() {\n        return this._color;\n      },\n      set: function set(value) {\n        this.material.shaderData.setColor(\"u_color\", value);\n        this._color = value;\n      }\n    }]);\n\n    return Border2;\n  }(_oasisEngine.Script);\n\n  function openDebug() {\n    var borderEntity = rootEntity.createChild(\"border\");\n    var color = new _oasisEngine.Color();\n    var border = borderEntity.addComponent(Border);\n    var config = {\n      plan: \"外描边\",\n      size: 3,\n      color: [0, 0, 0]\n    };\n    gui.add(config, \"plan\", [\"外描边\", \"内描边\"]).onChange(function (v) {\n      color.set(config.color[0] / 255, config.color[1] / 255, config.color[2] / 255, 1);\n      border.destroy();\n\n      if (v === \"外描边\") {\n        border = borderEntity.addComponent(Border);\n        border.size = config.size;\n        border.color = color;\n        showSize();\n      } else if (v === \"内描边\") {\n        border = borderEntity.addComponent(Border2);\n        border.size = config.size;\n        border.color = color;\n        showSize();\n      }\n    }).name(\"描边方案\");\n    var size;\n\n    function showSize() {\n      hideSize();\n      size = gui.add(config, \"size\", 0, 5, 1).onChange(function (v) {\n        border.size = v;\n      });\n    }\n\n    function hideSize() {\n      size && size.remove();\n      size = null;\n    }\n\n    showSize();\n    gui.addColor(config, \"color\").onChange(function (v) {\n      color.set(v[0] / 255, v[1] / 255, v[2] / 255, 1);\n      border.color = color;\n    });\n  }\n});"},"name":"outline-multi-pass","id":"24ceba8c-4bb4-584f-b0d6-e407a3c444bf"}}},"staticQueryHashes":[]}