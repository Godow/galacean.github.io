(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"2m7x":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var i=n("8rYJ"),s=n("wFc4"),o=n("0NNA"),a=n("xwgP"),r=n.n(a),A=n("Ac47"),l=(n("Qr5y"),{sky:{url:["https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*Gi7CTZqKuacAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*iRRMQIExwKMAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*ZIcPQZo20sAAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*SPYuTbHT-KgAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*mGUERbY77roAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*ilkPS7A1_JsAAAAAAAAAAABkARQnAQ"],sh:[1.4536975622177124,1.2322516441345215,.8864129185676575,-.44435063004493713,-.2984199821949005,-.04654404893517494,.2504007816314697,.23473940789699554,.10485957562923431,-.22722581028938293,-.23118487000465393,-.1346835047006607,.2024701088666916,.18827538192272186,.07655547559261322,-.26720723509788513,-.24846990406513214,-.1269611418247223,.1128435879945755,.07063852250576019,.008191842585802078,-.06712324172258377,-.12072498351335526,-.10238106548786163,.1859109252691269,.10431329905986786,-.017114786431193352]},house:{url:["https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*1gjTQ7P2mQoAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*entSR7DylL0AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*izQBQY_vs_4AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*x3XnRpq1U-EAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*k7FsT5Gprn0AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*8LdBQ6ixiQAAAAAAAAAAAABkARQnAQ"],sh:[.8962685465812683,.7656264901161194,.5087476968765259,-.5958908200263977,-.47178128361701965,-.4705639183521271,.12607601284980774,.059399981051683426,.029415369033813477,-.12036323547363281,-.08801775425672531,-.06222928687930107,.10942810773849487,.07969340682029724,.07417184114456177,.040593646466732025,.0655241310596466,.05116600915789604,-.0007216486847028136,.013710534200072289,-.03733639046549797,-.17561253905296326,-.1475340873003006,-.10067987442016602,-.24986475706100464,-.21295468509197235,-.25329700112342834]},sunnyDay:{url:["https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*4ZY8T4GpKwYAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*8QbJQZwS1wUAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*a54kSZ3LmAQAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*8CbfTb1yG8MAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*Yi4ZRZbdj8MAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*KddxSriLYjoAAAAAAAAAAABkARQnAQ"],sh:[.49732351303100586,.8204453587532043,1.1980727910995483,-.047882016748189926,.019423319026827812,.061979617923498154,-.05293811112642288,-.05558563023805618,-.05352041870355606,.018472276628017426,.01944858208298683,.02016768604516983,-.011690393090248108,-.015611638315021992,-.01910223439335823,.03366464003920555,.041282784193754196,.04779789596796036,.358532577753067,.4352142810821533,.44211071729660034,-.11810286343097687,-.12507741153240204,-.1150369867682457,.33062830567359924,.44129398465156555,.47715216875076294]},miniSampler:{url:["https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*IuyGR4bdwg4AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*4rv5RZ0kll4AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*cHitTpWoJjoAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*RCEbS6k5x18AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*IRc7R7cl4CcAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*y_4hRYVgzQ4AAAAAAAAAAABkARQnAQ"],sh:[.20824000239372253,.23156625032424927,.30640628933906555,-.032208919525146484,-.03681790828704834,-.08673757314682007,.026594972237944603,.04329078644514084,.06584044545888901,-.18646225333213806,-.25607162714004517,-.3791993260383606,.040871474891901016,.0778534933924675,.1789904683828354,.022585343569517136,.010101129300892353,-.004903033375740051,-.04522740840911865,-.0497514046728611,-.09917914122343063,-.00019472345593385398,-.01602073200047016,-.051514893770217896,.11432443559169769,.18823105096817017,.2658124566078186]},road:{url:["https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*4ebgQaWOLaIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*i56eR6AbreUAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*3wYERKsel5oAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*YiG7Srwmb3QAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*VUUwQrAv47sAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*Dn2qSoqzfwoAAAAAAAAAAAAAARQnAQ"],sh:[.2990323305130005,.46782827377319336,.6490488052368164,-.08325951546430588,-.1739923506975174,-.3481740653514862,.12110518664121628,.10342133790254593,.0647989809513092,.013654923066496849,.019375042989850044,.019014855846762657,-.010647064074873924,-.0158681683242321,-.01735353097319603,-.06292672455310822,-.06085652485489845,-.04486454278230667,.19867956638336182,.21928717195987701,.19299709796905518,.01943504437804222,.03246982768177986,.04340629279613495,.13364768028259277,.19655625522136688,.21748234331607819]}}),c=function(){function e(){var t=this;this.cubeTextures={},this.sh={},this.textures={},this.engine=new o.WebGLEngine("canvas-gltf-viewer",{alpha:!0}),this.scene=this.engine.sceneManager.activeScene,this.skyMaterial=new o.SkyBoxMaterial(this.engine),this.rootEntity=this.scene.createRootEntity("root"),this.cameraEntity=this.rootEntity.createChild("camera"),this.gltfRootEntity=this.rootEntity.createChild("gltf"),this.lightEntity1=this.rootEntity.createChild("light1"),this.lightEntity2=this.rootEntity.createChild("light2"),this.camera=this.cameraEntity.addComponent(o.Camera),this.controler=this.cameraEntity.addComponent(s.OrbitControl),this.light1=this.lightEntity1.addComponent(o.DirectLight),this.light2=this.lightEntity2.addComponent(o.DirectLight),this.gui=new window.dat.GUI,this.materialFolder=null,this.animationFolder=null,this.state={background:!1,envTexture:"miniSampler",addLights:!0,lightColor:e.colorToGui(new o.Color(1,1,1)),lightIntensity:.8},this._materials=[],this._boundingBox=new o.BoundingBox,this._center=new o.Vector3,this._extent=new o.Vector3,this.$spinner=document.getElementById("spinner"),this.$dropZone=document.getElementById("dropZone"),this.$input=document.getElementById("input");var n=this.gui.domElement.style;n.position="relative",n.top="68px",n.right="-12px",this.initResources().then((function(){t.initScene(),t.initDropZone(),t.addSceneGUI(),t.initDefaultDebugMesh()}))}e.guiToColor=function(e,t){t.setValue(e[0]/255,e[1]/255,e[2]/255,t.a)},e.colorToGui=function(e){void 0===e&&(e=new o.Color(1,1,1));var t=[];return t[0]=255*e.r,t[1]=255*e.g,t[2]=255*e.b,t};var t=e.prototype;return t.initResources=function(){var e=this,t=Object.keys(l);return new Promise((function(n){e.engine.resourceManager.load(t.map((function(e){return{type:o.AssetType.TextureCube,urls:l[e].url}}))).then((function(i){i.forEach((function(n,i){var s=t[i];if(e.cubeTextures[s]=n,l[s].sh){var a=new o.SphericalHarmonics3;a.setValueByArray(l[s].sh),e.sh[s]=a}s===e.state.envTexture&&(e.scene.ambientLight.specularTexture=n,e.scene.ambientLight.diffuseMode=o.DiffuseMode.SphericalHarmonics,e.scene.ambientLight.diffuseSphericalHarmonics=e.sh[s],e.skyMaterial.textureCubeMap=n)})),n(!0)}))}))},t.initScene=function(){this.engine.canvas.resizeByClientSize(),this.controler.minDistance=0,this.state.background&&(this.scene.background.mode=o.BackgroundMode.Sky),this.state.addLights||(this.light1.enabled=this.light2.enabled=!1),this.light1.intensity=this.light2.intensity=this.state.lightIntensity,this.lightEntity1.transform.setRotation(30,0,0),this.lightEntity2.transform.setRotation(-30,180,0),this.scene.background.solidColor=new o.Color(0,0,0,0),this.scene.background.sky.material=this.skyMaterial,this.scene.background.sky.mesh=o.PrimitiveMesh.createCuboid(this.engine,1,1,1),this.engine.run()},t.addSceneGUI=function(){var t=this,n=this.gui,s=n.addFolder("Scene");s.add(this.state,"background").onChange((function(e){t.scene.background.mode=e?o.BackgroundMode.Sky:o.BackgroundMode.SolidColor}));var a=n.addFolder("Lighting");a.add(this.state,"envTexture",["None"].concat(Object(i.a)(Object.keys(this.cubeTextures)))).name("IBL").onChange((function(e){t.scene.ambientLight.specularTexture=t.skyMaterial.textureCubeMap="None"===e?null:t.cubeTextures[e],t.scene.ambientLight.diffuseSphericalHarmonics="None"===e?null:t.sh[e],t.scene.ambientLight.diffuseMode="None"===e?o.DiffuseMode.SolidColor:o.DiffuseMode.SphericalHarmonics})),a.add(this.scene.ambientLight,"specularIntensity",0,2),a.add(this.scene.ambientLight,"diffuseIntensity",0,2),a.add(this.state,"addLights").onChange((function(e){t.light1.enabled=t.light2.enabled=e})).name("直接光"),a.addColor(this.state,"lightColor").onChange((function(n){e.guiToColor(n,t.light1.color),e.guiToColor(n,t.light2.color)})),a.add(this.state,"lightIntensity",0,2).onChange((function(e){t.light1.intensity=t.light2.intensity=e})).name("直接光强度"),s.open(),a.open()},t.initDefaultDebugMesh=function(){var e=o.PrimitiveMesh.createSphere(this.engine,5,64),t=new o.PBRMaterial(this.engine);t.metallic=0,t.roughness=0,t.name="default";var n=this.gltfRootEntity.addComponent(o.MeshRenderer);n.mesh=e,n.setMaterial(t),this.loadMaterialGUI([t]),this.setCenter([n])},t.setCenter=function(e){var t=this._boundingBox,n=this._center,i=this._extent;t.min.setValue(0,0,0),t.max.setValue(0,0,0),e.forEach((function(e){o.BoundingBox.merge(e.bounds,t,t)})),t.getExtent(i);var s=i.length();t.getCenter(n),this.controler.target.setValue(n.x,n.y,n.z),this.cameraEntity.transform.setPosition(n.x,n.y,3*s),this.camera.farClipPlane=12*s,this.camera.nearClipPlane>s?this.camera.nearClipPlane=s/10:this.camera.nearClipPlane=.1,this.controler.maxDistance=10*s},t.initDropZone=function(){var e=this;new window.SimpleDropzone.SimpleDropzone(document.body,this.$input).on("drop",(function(t){var n=t.files;return e.loadFileMaps(n)}))},t.loadFileMaps=function(e){var t,n=this,i=/\.(gltf|glb)$/i,s=/\.(jpg|jpeg|png)$/i,o="gltf",a={},r=Array.from(e);if(r.some((function(e){var n=e[1];return!!i.test(n.name)&&(o=RegExp.$1,t=n,!0)})),r.forEach((function(e){var t=e[1];if(!i.test(t.name)){var o=URL.createObjectURL(t),r=t.name;a[r]=o,s.test(r)&&n.addTexture(r,o)}})),t){this.dropStart();var A=URL.createObjectURL(t);this.loadModel(A,a,o)}},t.loadModel=function(e,t,n){var i=this;this.destoryGLTF(),"gltf"===n.toLowerCase()?this.engine.resourceManager.load({type:o.AssetType.JSON,url:e}).then((function(e){e.buffers.concat(e.images).forEach((function(e){if(e){var n=e.uri;t[n]&&(e.uri=t[n])}}));var n=new Blob([JSON.stringify(e)]),s=URL.createObjectURL(n);i.engine.resourceManager.load({type:o.AssetType.Prefab,url:s+"#.gltf"}).then((function(e){i.handleGltfResource(e)})).catch((function(){i.dropError()}))})):this.engine.resourceManager.load({type:o.AssetType.Prefab,url:e+"#.glb"}).then((function(e){i.handleGltfResource(e)})).catch((function(){i.dropError()}))},t.handleGltfResource=function(e){var t=e.defaultSceneRoot,n=e.materials,i=e.animations;console.log(e),this.dropSuccess(),this.gltfRootEntity=t,this.rootEntity.addChild(t);var s=[],a=[];t.getComponentsIncludeChildren(o.MeshRenderer,s),t.getComponentsIncludeChildren(o.SkinnedMeshRenderer,a),this.setCenter(s.concat(a)),this.loadMaterialGUI(n),this.loadAnimationGUI(i)},t.addTexture=function(e,t){var n=this;Object.keys(this.textures).find((function(t){return t===e}))?console.warn(e+" 已经存在，请更换图片名字重新上传"):this.engine.resourceManager.load({type:o.AssetType.Texture2D,url:t}).then((function(t){n.textures[e]=t,n.loadMaterialGUI(),console.log("图片上传成功！",e)}))},t.dropStart=function(){this.$dropZone.classList.add("hide"),this.$spinner.classList.remove("hide")},t.dropError=function(){this.$dropZone.classList.remove("hide"),this.$spinner.classList.add("hide")},t.dropSuccess=function(){this.$dropZone.classList.add("hide"),this.$spinner.classList.add("hide")},t.destoryGLTF=function(){this.gltfRootEntity.destroy()},t.loadMaterialGUI=function(t){var n=this,s=this.gui;this.materialFolder&&(s.removeFolder(this.materialFolder),this.materialFolder=null);var a=t||this._materials;if(this._materials=a,a.length){var r=this.materialFolder=s.addFolder("Material"),A={};a.forEach((function(t){if(t instanceof o.PBRBaseMaterial||t instanceof o.UnlitMaterial){t.name||(t.name="default");var s={opacity:t.baseColor.a,baseColor:e.colorToGui(t.baseColor),emissiveColor:e.colorToGui(t.emissiveColor),specularColor:e.colorToGui(t.specularColor),baseTexture:t.baseTexture?"origin":"",roughnessMetallicTexture:t.roughnessMetallicTexture?"origin":"",normalTexture:t.normalTexture?"origin":"",emissiveTexture:t.emissiveTexture?"origin":"",occlusionTexture:t.occlusionTexture?"origin":"",specularGlossinessTexture:t.specularGlossinessTexture?"origin":""},a={baseTexture:t.baseTexture,roughnessMetallicTexture:t.roughnessMetallicTexture,normalTexture:t.normalTexture,emissiveTexture:t.emissiveTexture,occlusionTexture:t.occlusionTexture,specularGlossinessTexture:t.specularGlossinessTexture},l=r.addFolder(A[t.name]?t.name+"_"+(A[t.name]+1):t.name);if(A[t.name]=null==A[t.name]?1:A[t.name]+1,t instanceof o.PBRMaterial){var c=l.addFolder("金属模式");c.add(t,"metallic",0,1).step(.01),c.add(t,"roughness",0,1).step(.01),c.add(s,"roughnessMetallicTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.roughnessMetallicTexture="None"===e?null:n.textures[e]||a.roughnessMetallicTexture})),c.open()}else if(t instanceof o.PBRSpecularMaterial){var u=l.addFolder("高光模式");u.add(t,"glossiness",0,1).step(.01),u.addColor(s,"specularColor").onChange((function(n){e.guiToColor(n,t.specularColor)})),u.add(s,"specularGlossinessTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.specularGlossinessTexture="None"===e?null:n.textures[e]||a.specularGlossinessTexture})),u.open()}else t instanceof o.UnlitMaterial&&(l.add(s,"baseTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.baseTexture="None"===e?null:n.textures[e]||a.baseTexture})),l.addColor(s,"baseColor").onChange((function(n){e.guiToColor(n,t.baseColor)})));if(!(t instanceof o.UnlitMaterial)){var d=l.addFolder("通用");d.add(s,"opacity",0,1).step(.01).onChange((function(e){t.baseColor.a=e})),d.add(t,"isTransparent"),d.add(t,"alphaCutoff",0,1).step(.01),d.addColor(s,"baseColor").onChange((function(n){e.guiToColor(n,t.baseColor)})),d.addColor(s,"emissiveColor").onChange((function(n){e.guiToColor(n,t.emissiveColor)})),d.add(s,"baseTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.baseTexture="None"===e?null:n.textures[e]||a.baseTexture})),d.add(s,"normalTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.normalTexture="None"===e?null:n.textures[e]||a.normalTexture})),d.add(s,"emissiveTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.emissiveTexture="None"===e?null:n.textures[e]||a.emissiveTexture})),d.add(s,"occlusionTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.occlusionTexture="None"===e?null:n.textures[e]||a.occlusionTexture})),d.open()}}})),r.open()}},t.loadAnimationGUI=function(e){if(this.animationFolder&&(this.gui.removeFolder(this.animationFolder),this.animationFolder=null),null!=e&&e.length){this.animationFolder=this.gui.addFolder("Animation"),this.animationFolder.open();var t=this.gltfRootEntity.getComponent(o.Animator);t.play(e[0].name);var n={animation:e[0].name};this.animationFolder.add(n,"animation",["None"].concat(Object(i.a)(e.map((function(e){return e.name}))))).onChange((function(e){"None"===e?t.speed=0:(t.speed=1,t.play(e))}))}},e}();function u(e){return Object(a.useEffect)((function(){var e,t=[{dom:null,url:"https://gw.alipayobjects.com/os/lib/dat.gui/0.7.7/build/dat.gui.min.js"},{dom:null,url:"https://gw.alipayobjects.com/os/lib/simple-dropzone/0.8.1/dist/simple-dropzone.umd.js"}];return Promise.all(t.map((function(e){return new Promise((function(t){var n=document.createElement("script");n.type="text/javascript",document.body.appendChild(n),n.onload=function(){t(void 0)},n.src=e.url,e.dom=n}))}))).then((function(){e=new c})),function(){t.forEach((function(e){document.body.removeChild(e.dom)})),e.gui.destroy(),e.engine.destroy()}})),r.a.createElement(r.a.Fragment,null,r.a.createElement(A.a,e,r.a.createElement("div",{className:"page-gltf-view"},r.a.createElement("canvas",{id:"canvas-gltf-viewer",style:{width:"100%",height:"calc(100vh - 64px)"}}),r.a.createElement("input",{id:"input",type:"file",className:"hide"}),r.a.createElement("div",{id:"dropZone",className:"dropZone"},r.a.createElement("p",null,"Drag glTF2.0 and texture files or folder on the viewport")),r.a.createElement("div",{id:"spinner",className:"spinner hide"}),r.a.createElement("script",{type:"module",src:"./src/index.ts"}))))}},Qr5y:function(e,t,n){}}]);